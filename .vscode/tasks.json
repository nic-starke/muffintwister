{
	"version": "2.0.0",
	"inputs": [
		{
			"id": "cross_file",
			"type": "command",
			"command": "cpptools.activeConfigCustomVariable",
			"args": "cross_file",
		},
	],
	"tasks": [
		{
			"label": "Meson Generate",
			"detail": "Generates the build folder ready for compilation",
			"type": "shell",
			"linux": {
				"command": "meson"
			},
			"args": [
				"setup",
				"${config:app.build_dir}",
				"--cross-file",
				"${input:cross_file}"
			],
			"problemMatcher": [
				"$meson-gcc"
			]
		},
		{
			"label": "Clean",
			"detail": "Clean the build folder",
			"type": "shell",
			"group": {
				"kind": "build",
			},
			"linux": {
				"command": "ninja"
			},
			"options": {
				"cwd": "${config:app.build_dir}",
				"env": {}
			},
			"args": [
				"clean",
			],
		},
		{
			"label": "Build (clean)",
			"detail": "Builds the project, cleans first",
			"type": "shell",
			"group": {
				"kind": "build",
				"isDefault": true
			},
			"dependsOn": [
				"Clean"
			],
			"linux": {
				"command": "ninja"
			},
			"options": {
				"cwd": "${config:app.build_dir}",
				"env": {}
			},
			"args": [
				"neosam.elf",
				"neosam.hex",
			],
			"presentation": {
				"echo": true,
				"showReuseMessage": false,
				"reveal": "always",
				"revealProblems": "never",
				"panel": "dedicated",
				"focus": true,
				"clear": false,
				"close": false
			},
			"problemMatcher": {
				"applyTo": "allDocuments",
				"base": "$gcc",
				"fileLocation": [
					"relative",
					"${workspaceFolder}/src"
				],
			},
		},
		{
			"label": "Size",
			"detail": "Displays size (mem usage) of binary",
			"type": "shell",
			"group": {
				"kind": "build",
			},
			"linux": {
				"command": "ninja"
			},
			"options": {
				"cwd": "${config:app.build_dir}",
				"env": {}
			},
			"args": [
				"BinSize"
			],
		},
		{
			"label": "Flash Board",
			"detail": "Programs the board with a built binary",
			"type": "shell",
			"group": {
				"kind": "build",
			},
			"dependsOn": "Build (clean)",
			"linux": {
				"command": "avrdude"
			},
			"args": [
				"-v",
				"-c",
				"jtag3pdi",
				"-p",
				"x128a4u",
				"-P",
				"usb",
				"-U",
				"flash:w:\"${config:app.build_dir}/neosam.hex\":a",
				// # avrdude -v -u -c jtag3pdi -p x128a4u -P usb -U eeprom:w:"build/neosam.eep"
				//  if using dfu-programmer
				// #sudo dfu-programmer atxmega128a4u:1,8 flash ./builddir/neosam.hex
				// #where :1,8 is the usb BUS and DEVICE numbers from lsusb
				// # but make sure to put the mft into bootloader mode and then exec lsusb, then dfu-programmer
			],
		},
	],
}